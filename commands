# at boot
1. start_wpa
2. check if wlan0 has address
3. if not:
    1. check wpa_cli status
    2. if COMPLETED
        go to 4.
    3. if INACTIVE|DISCONNECTED
        1. wpa_supplicant.conf isn't configured
        2. go to 7.
4. dhclient wlan0
5. check wlan address, confirm connection
6. run sensors
7. listen for button

# at button
1. turn down wlan0
2. enable ap0
3. launch web
    1. scan for ssids
4. ap0 should only be up temporarily. 
    set a timer. 10 mins?
    after timer:
        disable ap0
        bounce wlan0

#wpaup
wpa_supplicant -B -i wlan0 -c /etc/wpa_supplicant/wpa_supplicant.conf
wpa_supplicant -B -Dnl80211 -dd -i wlan0 -c /etc/wpa_supplicant/wpa_supplicant.conf

#wlan has address
ip neigh
> 192.168.1.1 dev wlan0 lladdr a8:9a:93:a4:70:e2 REACHABLE

#wpa state
wpa_cli status
> wpa_state=COMPLETED|INACTIVE|DISCONNECTED

#scan for ssids
iw wlan0 scan | egrep 'SSID: \w' | awk '{print $2}'

#wlanup
ifconfig wlan0 up
dhclient wlan0

#wlan down
ifconfig wlan0 down
wpa_cli terminate
dhclient -r
ip addr flush wlan0
rm /var/run/wpa_supplicant/wlan0

#ap up
rm /var/run/hostapd/ap0
iw phy phy0 interface add ap0 type __ap
ifconfig ap0 up
ifconfig ap0 192.168.100.1
hostapd -B /etc/hostapd/hostapd.conf
dnsmasq

#ap down
ifconfig ap0 down
iw dev ap0 del
killall hostapd dnsmasq

